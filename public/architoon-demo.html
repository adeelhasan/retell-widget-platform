<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget Example - Retell AI Voice Integration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 60px 40px;
            max-width: 600px;
            width: 100%;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            margin: 0 auto 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        h1 {
            color: #1a202c;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 12px;
            line-height: 1.2;
        }

        .subtitle {
            color: #64748b;
            font-size: 18px;
            margin-bottom: 40px;
            line-height: 1.5;
        }

        .widget-section {
            background: #f8fafc;
            border: 2px dashed #cbd5e1;
            border-radius: 16px;
            padding: 40px 20px;
            margin: 40px 0;
            transition: all 0.3s ease;
        }

        .widget-section:hover {
            border-color: #667eea;
            background: #f1f5f9;
        }

        .widget-label {
            color: #475569;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .feature {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .feature-icon {
            width: 60px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: bold;
            letter-spacing: 0.5px;
        }

        .feature h3 {
            color: #1a202c;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .feature p {
            color: #64748b;
            font-size: 14px;
            line-height: 1.5;
        }

        .metadata-info {
            background: #fefce8;
            border: 1px solid #fde047;
            border-radius: 12px;
            padding: 16px;
            margin-top: 30px;
        }

        .metadata-info h4 {
            color: #854d0e;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .metadata-info p {
            color: #a16207;
            font-size: 13px;
            line-height: 1.4;
        }

        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            color: #64748b;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 40px 20px;
                margin: 10px;
            }

            h1 {
                font-size: 28px;
            }

            .subtitle {
                font-size: 16px;
            }

            .features {
                grid-template-columns: 1fr;
            }
        }

        /* Animation for widget load */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            animation: fadeInUp 0.6s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        
        <h1>Widget Integration Example</h1>
        <p class="subtitle">
            Complete example showing how to embed Retell AI voice widgets with metadata
        </p>

        <div class="widget-section">
            <div class="widget-label">Your Widget</div>
            
            <!-- 
            ============================================================
            REPLACE THIS SECTION WITH YOUR EMBED CODE
            ============================================================
            -->
            
            <!-- EXAMPLE EMBED CODE - REPLACE WITH YOUR ACTUAL VALUES -->
            <!-- Get your widget ID from the dashboard after creating a widget -->
            <script 
            src="https://retell-widget-platform.vercel.app/api/widget-simple" 
            data-widget-id="d8d6fb2a-b04e-4a6f-ad7e-5f223e6f90bb"
          ></script>

          <form class="retell-metadata" data-widget-id="d8d6fb2a-b04e-4a6f-ad7e-5f223e6f90bb">
            <input type="hidden" name="agent_name" value="Demo Agent">
            <input type="hidden" name="property_type" value="Example Property">
            <input type="hidden" name="lead_source" value="Website Demo">
        </form>
        
            
            
            <!-- 
            ============================================================
            END EMBED CODE SECTION
            ============================================================
            -->
            
            <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 12px; margin-top: 16px;">
                <p style="color: #92400e; font-size: 14px; font-weight: 600; margin-bottom: 4px;">‚ö†Ô∏è Demo Widget (Non-Functional)</p>
                <p style="color: #92400e; font-size: 12px; margin-bottom: 8px;">
                    This is a placeholder widget ID. To make it functional:
                </p>
                <ol style="color: #92400e; font-size: 12px; margin-left: 16px; line-height: 1.4;">
                    <li>Go to <a href="/dashboard" style="color: #d97706; text-decoration: underline;">Dashboard</a></li>
                    <li>Create a widget with domain: <code>https://retell-widget-platform.vercel.app</code></li>
                    <li>Replace <code>your-widget-id-here</code> with your actual widget ID</li>
                    <li>The widget will then connect to your Retell AI agent</li>
                </ol>
            </div>
        </div>

        <div class="features">
            <div class="feature">
                <div class="feature-icon">üîí</div>
                <h3>Secure</h3>
                <p>Domain verification ensures your widget only works on authorized sites</p>
            </div>
            
            <div class="feature">
                <div class="feature-icon">‚ö°</div>
                <h3>Fast</h3>
                <p>Lightweight script loads instantly and connects quickly to voice AI</p>
            </div>
            
            <div class="feature">
                <div class="feature-icon">üé®</div>
                <h3>Customizable</h3>
                <p>Configurable button text, metadata, and styling options</p>
            </div>
        </div>

        <div class="metadata-info">
            <h4>‚úÖ Ready for Production</h4>
            <p>
                This widget uses the official Retell SDK with proper bundling and real voice streaming.
                Simply copy the embed code above and paste it into any website for instant voice AI integration.
            </p>
        </div>

        <div class="footer">
            <p>
                <strong>Ready to use:</strong> This widget is fully functional with real voice streaming.
                Copy the embed code above and use it on any website for instant voice AI integration.
            </p>
        </div>

        <!-- Debug Panel for iOS Chrome Troubleshooting -->
        <div id="debug-panel" style="
            margin-top: 30px;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #333;
        ">
            <div style="color: #ffff00; font-weight: bold; margin-bottom: 10px;">üîç DEBUG LOG (iOS Chrome Troubleshooting)</div>
            <div id="debug-log">Initializing debug panel...</div>
        </div>
    </div>

    <script>
        // Debug logger for iOS Chrome troubleshooting
        window.debugLog = function(message, type = 'info') {
            const logElement = document.getElementById('debug-log');
            if (!logElement) return;
            
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#00ff00',
                error: '#ff4444',
                warning: '#ffaa00',
                success: '#00ffaa'
            };
            
            const logEntry = document.createElement('div');
            logEntry.style.color = colors[type] || colors.info;
            logEntry.style.marginBottom = '5px';
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        };

        // Log browser info immediately
        setTimeout(() => {
            debugLog('=== BROWSER INFO ===', 'warning');
            debugLog(`User Agent: ${navigator.userAgent}`);
            debugLog(`Platform: ${navigator.platform}`);
            debugLog(`URL: ${window.location.href}`);
            debugLog(`Protocol: ${window.location.protocol}`);
            debugLog(`Is HTTPS: ${window.location.protocol === 'https:'}`);
            
            // Check iOS detection
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
            const isChrome = /Chrome/.test(navigator.userAgent) && !/Edg/.test(navigator.userAgent);
            debugLog(`Is iOS: ${isIOS}`, isIOS ? 'warning' : 'info');
            debugLog(`Is Chrome: ${isChrome}`, isChrome ? 'warning' : 'info');
            debugLog(`Is iOS Chrome: ${isIOS && isChrome}`, (isIOS && isChrome) ? 'error' : 'info');
            
            // Check microphone support
            debugLog('=== MICROPHONE SUPPORT ===', 'warning');
            debugLog(`navigator.mediaDevices exists: ${!!navigator.mediaDevices}`);
            debugLog(`getUserMedia exists: ${!!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia)}`);
            
            if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
                navigator.mediaDevices.enumerateDevices()
                    .then(devices => {
                        const audioInputs = devices.filter(d => d.kind === 'audioinput');
                        debugLog(`Audio input devices found: ${audioInputs.length}`);
                        audioInputs.forEach((device, i) => {
                            debugLog(`  Device ${i+1}: ${device.label || 'Unknown'}`);
                        });
                    })
                    .catch(err => debugLog(`Device enumeration failed: ${err.message}`, 'error'));
            }
            
            // Add iOS Chrome specific guidance
            if (isIOS && isChrome) {
                debugLog('=== iOS CHROME DETECTED ===', 'error');
                debugLog('‚ö†Ô∏è  IMPORTANT: If voice calls fail with "NotAllowedError":', 'warning');
                debugLog('üì± Go to: iPhone Settings > Privacy & Security > Microphone', 'warning');
                debugLog('üîß Find "Chrome" and make sure it is ENABLED', 'warning');
                debugLog('üîÑ Refresh this page after enabling microphone access', 'warning');
            }
            
            debugLog('=== READY FOR WIDGET TEST ===', 'success');
        }, 500);

        // Override console.log to also log to debug panel
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            debugLog(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            const errorMsg = args.join(' ');
            debugLog('ERROR: ' + errorMsg, 'error');
            
            // Special handling for NotAllowedError on iOS Chrome
            if (errorMsg.includes('NotAllowedError')) {
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
                const isChrome = /Chrome/.test(navigator.userAgent) && !/Edg/.test(navigator.userAgent);
                
                if (isIOS && isChrome) {
                    debugLog('', 'error');
                    debugLog('üí° SOLUTION FOR iOS CHROME USERS:', 'warning');
                    debugLog('1. Open iPhone Settings app', 'warning');
                    debugLog('2. Go to Privacy & Security > Microphone', 'warning');
                    debugLog('3. Find "Chrome" in the app list', 'warning');
                    debugLog('4. Toggle Chrome microphone access ON', 'warning');
                    debugLog('5. Refresh this page and try again', 'warning');
                }
            }
        };
    </script>

</body>
</html>